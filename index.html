<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Mausritter Character Sheet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <style>
        #item-pool>.draggable-item {
            box-sizing: border-box;
            max-width: 100%;
            word-break: break-word;
            white-space: normal;
        }

        .draggable-item .text-base {
            white-space: normal;
            word-break: break-word;
        }

        html.invert-dark body {
            filter: invert(1) hue-rotate(180deg);
            background: #181825 !important;
        }

        html.invert-dark body img,
        html.invert-dark body video {
            filter: invert(1) hue-rotate(180deg);
        }

        #item-pool {
            min-height: 5rem;
            border: 2px dashed #cbd5e1;
        }
    </style>
    <script>
        // Prevent flash of wrong theme
        if (localStorage.getItem('dark-mode') === 'on') {
            document.documentElement.classList.add('invert-dark');
            document.body && document.body.classList.add('invert-dark');
        }
    </script>
</head>

<body class="flex items-center justify-center min-h-screen bg-gray-100">
    <div class="w-[210mm] h-[297mm] bg-white shadow-lg p-8">
        <div class="flex w-full gap-6">
            <!-- Left Column (3/5) -->
            <div class="w-3/5 flex flex-col gap-6">
                <!-- Name & Background-->
                <div class="bg-white rounded-xl shadow-md border border-black p-4">
                    <!-- Name Row -->
                    <div class="flex items-center pb-4">
                        <label class="w-1/3 font-extrabold text-gray-700 text-3xl tracking-tight">Name</label>
                        <input type="text" id="character-name" placeholder="Enter name"
                            class="shrink-on-overflow w-2/3 bg-transparent border-none p-0 text-xl focus:outline-none my-auto" />
                    </div>
                    <!-- Divider -->
                    <div class="border-t-2 border-black"></div>
                    <!-- Background Row -->
                    <div class="flex items-center pt-4">
                        <label class="w-1/3 font-semibold text-gray-700">Background</label>
                        <input type="text" id="character-background" placeholder="Enter background"
                            class="shrink-on-overflow w-2/3 bg-transparent border-none p-0 focus:outline-none" />
                    </div>
                </div>

                <!-- Description -->
                <div class="bg-white p-0 rounded-xl">
                    <table class="table-auto w-full">
                        <tbody>
                            <tr>
                                <td class="pb-2 font-semibold text-gray-700 text-center">Description</td>
                            </tr>
                            <tr>
                                <td>
                                    <textarea id="character-description" rows="8"
                                        class="w-full px-4 py-3 text-base rounded-md resize-none"
                                        placeholder="Enter description..."></textarea>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Inventory -->
                <div class="flex justify-between items-center mb-2">
                    <label class="font-semibold text-gray-700 text-xl mt-2">Inventory</label>
                </div>
            </div>

            <!-- Right Column (2/5) -->
            <div class="w-2/5 flex flex-col gap-6">

                <!-- Info -->
                <div class="bg-white p-2 rounded-xl">
                    <table class="table-auto w-full">
                        <tbody>
                            <tr>
                                <td class="pr-4 py-2 font-semibold text-gray-700 text-sm">Birthsign</td>
                                <td>
                                    <input type="text" id="character-birthsign"
                                        class="shrink-on-overflow w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"
                                        placeholder="Enter birthsign">
                                </td>
                            </tr>
                            <tr>
                                <td class="pr-4 py-2 font-semibold text-gray-700 text-sm">Coat</td>
                                <td>
                                    <input type="text" id="character-coat"
                                        class="shrink-on-overflow w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"
                                        placeholder="Enter coat">
                                </td>
                            </tr>
                            <tr>
                                <td class="pr-4 py-2 font-semibold text-gray-700 text-sm">Look</td>
                                <td>
                                    <input type="text" id="character-look"
                                        class="shrink-on-overflow w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"
                                        placeholder="Enter look">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Stats Table -->
                <table class="table-auto w-full text-center border-collapse">
                    <thead>
                        <tr class="text-gray-700 font-semibold">
                            <th class="w-1/3"></th>
                            <th class="w-1/3">Max</th>
                            <th class="w-1/3">Current</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="font-semibold text-gray-700 py-2 bg-gray-200 border border-black">STR</td>
                            <td class="border border-black"><input type="number" id="stat-str-max"
                                    class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center" /></td>
                            <td class="border border-black"><input type="number" id="stat-str-current"
                                    class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center" /></td>
                        </tr>
                        <tr>
                            <td class="font-semibold text-gray-700 py-2 bg-gray-200 border border-black">DEX</td>
                            <td class="border border-black"><input type="number" id="stat-dex-max"
                                    class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center" /></td>
                            <td class="border border-black"><input type="number" id="stat-dex-current"
                                    class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center" /></td>
                        </tr>
                        <tr>
                            <td class="font-semibold text-gray-700 py-2 bg-gray-200 border border-black">WIL</td>
                            <td class="border border-black"><input type="number" id="stat-wil-max"
                                    class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center" /></td>
                            <td class="border border-black"><input type="number" id="stat-wil-current"
                                    class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center" /></td>
                        </tr>
                    </tbody>
                </table>

                <!-- HP Table -->
                <table class="table-auto w-full text-center border-collapse mt-4">
                    <tbody>
                        <tr>
                            <td class="font-semibold text-gray-700 py-2 bg-gray-200 border border-black w-1/3">HP</td>
                            <td class="border border-black w-1/3"><input type="number" id="stat-hp-max"
                                    class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center" /></td>
                            <td class="border border-black w-1/3"><input type="number" id="stat-hp-current"
                                    class="w-16 px-2 py-1 border border-gray-300 rounded-md text-center" /></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr class="text-gray-700 font-semibold">
                            <th class="w-1/3"></th>
                            <th class="w-1/3">Max</th>
                            <th class="w-1/3">Current</th>
                        </tr>
                    </tfoot>

                    <!-- Pips Table -->
                </table>
                <table class="table-auto text-center border-collapse">
                    <tbody>
                        <tr>
                            <td class="font-semibold text-gray-700 py-1 bg-gray-200 border border-black w-24">Pips
                            </td>
                            <td class="border border-black w-24"><input type="number" id="pips-amount"
                                    class="w-16 px-2 py-0.5 border border-gray-300 rounded-md text-center" /></td>
                            <td class="border border-black w-24"> 250</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Inventory Grid -->
        <div class="grid grid-cols-5 gap-0 mt-4" id="inventory-grid">
            <div class="inventory-slot w-36 h-36 border border-gray-300 border-dotted flex items-center justify-center"
                data-slot="0" data-label="Main paw" data-row="0" data-col="0">Main paw</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 border-dotted flex items-center justify-center"
                data-slot="1" data-label="Body" data-row="0" data-col="1">Body</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 flex items-center justify-center" data-slot="2"
                data-label="1" data-row="0" data-col="2">1</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 flex items-center justify-center" data-slot="3"
                data-label="2" data-row="0" data-col="3">2</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 flex items-center justify-center" data-slot="4"
                data-label="3" data-row="0" data-col="4">3</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 border-dotted flex items-center justify-center"
                data-slot="5" data-label="Off paw" data-row="1" data-col="0">Off paw</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 border-dotted flex items-center justify-center"
                data-slot="6" data-label="Body" data-row="1" data-col="1">Body</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 flex items-center justify-center" data-slot="7"
                data-label="4" data-row="1" data-col="2">4</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 flex items-center justify-center" data-slot="8"
                data-label="5" data-row="1" data-col="3">5</div>
            <div class="inventory-slot w-36 h-36 border border-gray-300 flex items-center justify-center" data-slot="9"
                data-label="6" data-row="1" data-col="4">6</div>
        </div> <!-- Stats Containers -->
        <div class="flex gap-4 mt-4">
            <!-- Level and XP Container -->
            <div class="w-1/5 border border-gray-300 p-4 rounded-md">
                <div class="grid grid-cols-1 gap-2">
                    <div class="border border-gray-300 p-2 rounded">
                        <div class="font-semibold text-gray-700">Level</div>
                        <input type="number" id="character-level"
                            class="w-full px-2 py-1 border border-gray-300 rounded-md text-center" />
                    </div>
                    <div class="border border-gray-300 p-2 rounded">
                        <div class="font-semibold text-gray-700">XP</div>
                        <input type="number" id="character-xp"
                            class="w-full px-2 py-1 border border-gray-300 rounded-md text-center" />
                    </div>
                </div>
            </div>

            <!-- Grit and Ignored Container -->
            <div class="w-2/5 border border-gray-300 p-4 rounded-md">
                <div class="grid grid-cols-1 gap-2">
                    <div class="border border-gray-300 p-2 rounded">
                        <div class="font-semibold text-gray-700">Grit</div>
                        <input type="number" id="character-grit"
                            class="w-full px-2 py-1 border border-gray-300 rounded-md text-center" />
                    </div>
                    <div class="border border-gray-300 p-2 rounded">
                        <div class="font-semibold text-gray-700">Ignored conditions</div>
                        <input type="text" id="ignored-conditions"
                            class="shrink-on-overflow w-full px-2 py-1 border border-gray-300 rounded-md text-center" />
                    </div>
                </div>
            </div>

            <!-- Banked Items Container -->
            <div class="w-2/5 border border-gray-300 p-4 rounded-md">
                <div class="flex justify-between items-center mb-2">
                    <div class="font-semibold text-gray-700">Banked items and pips</div>
                </div>
                <textarea id="banked-items" class="w-full h-32 px-2 py-1 border border-gray-300 rounded-md"></textarea>
            </div>
        </div>
        <!-- Footer -->
        <div class="mt-6 border-t border-gray-300 pt-2 text-xs text-gray-500 text-center">
            This is a personal project. Original character sheet design © <a href="https://mausritter.com"
                class="underline hover:text-gray-700" target="_blank">Mausritter</a> by Losing Games.
        </div>
    </div>

    <!-- Side Drawer -->
    <div id="drawer"
        class="fixed top-0 right-0 w-[26rem] h-full bg-white shadow-lg transform translate-x-full transition-transform duration-300 z-50 p-8">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800">Create Item</h2>
            <button onclick="toggleDrawer()" class="text-gray-600 hover:text-black text-2xl">&times;</button>
        </div>
        <!-- Custom Item Creator -->
        <form class="grid grid-cols-2 gap-4 mb-4">
            <div class="space-y-2 col-span-2">
                <label for="item-title" class="block text-sm font-medium text-gray-700">Item Name</label>
                <input id="item-title" type="text" placeholder="Enter item name"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="space-y-2">
                <label for="item-usage" class="block text-sm font-medium text-gray-700">Usage Dots</label>
                <input id="item-usage" type="number" placeholder="0-6" min="0" max="6"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="space-y-2">
                <label for="item-extra" class="block text-sm font-medium text-gray-700">Extra Info</label>
                <input id="item-extra" type="text" placeholder="e.g. d6"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="space-y-2">
                <label for="item-type" class="block text-sm font-medium text-gray-700">Type</label>
                <input id="item-type" type="text" placeholder="e.g. Light"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="space-y-2">
                <label for="item-size" class="block text-sm font-medium text-gray-700">Size</label>
                <select id="item-size"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="1x1">1x1 (Normal)</option>
                    <option value="1x2">1x2 (Tall)</option>
                    <option value="2x1">2x1 (Wide)</option>
                    <option value="2x2">2x2 (Massive)</option> <!-- Added option -->
                </select>
            </div>
            <div class="col-span-2">
                <button type="button" onclick="createCustomItem()"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-150 ease-in-out font-medium">
                    Create Item
                </button>
            </div>
        </form>
        <!-- Where new items will go -->
        <div id="item-pool" class="mt-6 grid auto-rows-min grid-cols-1 gap-6 overflow-y-auto"
            style="max-height: 60vh; align-items: start;"></div>
    </div>

    <!-- Toggle Button -->
    <button onclick="toggleDrawer()" class="fixed top-4 right-4 z-50 bg-blue-600 text-white px-3 py-1 rounded shadow">
        + Add Item
    </button>
    <button id="dark-toggle" class="fixed top-4 left-4 z-50 bg-gray-800 text-white px-3 py-1 rounded shadow">
        Toggle Dark Mode
    </button>
    <button id="reset-sheet" class="fixed top-16 left-4 z-50 bg-red-600 text-white px-3 py-1 rounded shadow">
        Reset Sheet
    </button>

    <script src="main.js"></script>
    <script src="inventory.js"></script>
    <script src="storage.js"></script>
    <script>
        // Restore dark mode from localStorage on load
        if (localStorage.getItem('dark-mode') === 'on') {
            document.body.classList.add('invert-dark');
        }

        document.getElementById('dark-toggle').onclick = function () {
            document.documentElement.classList.toggle('invert-dark');
            document.body.classList.toggle('invert-dark');
            // Save state to localStorage
            if (document.documentElement.classList.contains('invert-dark')) {
                localStorage.setItem('dark-mode', 'on');
            } else {
                localStorage.setItem('dark-mode', 'off');
            }
        }
        document.getElementById('reset-sheet').onclick = function () {
            if (confirm('Are you sure you want to reset the character sheet? This will erase all data.')) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
    <script>
        // Shrink input font size if text overflows
        function adjustInputFontSize(input, minFontSize = 10, maxFontSize = 16) {
            input.style.fontSize = maxFontSize + 'px';
            // Shrink font size until text fits or minFontSize reached
            while (input.scrollWidth > input.clientWidth && parseInt(input.style.fontSize) > minFontSize) {
                input.style.fontSize = (parseInt(input.style.fontSize) - 1) + 'px';
            }
        }
        function updateAllShrinkInputs() {
            document.querySelectorAll('.shrink-on-overflow').forEach(input => {
                adjustInputFontSize(input);
            });
        }
        document.querySelectorAll('.shrink-on-overflow').forEach(input => {
            input.addEventListener('input', function () {
                adjustInputFontSize(this);
            });
        });
        // Ensure shrink-to-fit runs after page load and after autofill/localStorage restore
        window.addEventListener('DOMContentLoaded', updateAllShrinkInputs);
        window.addEventListener('load', updateAllShrinkInputs);
    </script>
</body>

</html>